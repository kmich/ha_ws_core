# =============================================================================
# WEATHER STATION VANILLA DASHBOARD v1.2.0
# =============================================================================
# Uses ONLY native Home Assistant cards. No HACS frontend dependencies.
#
# Usage: Dashboard > Edit > Raw Configuration Editor > paste > save
#
# Assumes default prefix "ws". If you used a different prefix,
# find-and-replace "sensor.ws_" with "sensor.YOURPREFIX_"
# and "weather.ws" with "weather.YOURPREFIX".
#
# Radar: Update lat/lon in the Windy iframe URL to your location.
#
# Optional HACS card: lovelace-windrose-card for wind rose on Analysis page.
# Install via HACS > Frontend, then uncomment the wind rose section below.
# =============================================================================

views:
  # =============================================
  # PAGE 1: MAIN WEATHER
  # =============================================
  - title: Weather
    path: weather
    icon: mdi:weather-partly-cloudy
    cards:
      # --- STORM MODE BANNER (auto-shows when alerts active) ---
      - type: conditional
        conditions:
          - condition: state
            entity: sensor.ws_alert_state
            state_not: clear
        card:
          type: markdown
          content: >-
            ## ⚠️ Weather Alert Active

            **{{ states('sensor.ws_alert_message') }}**

            Rain rate: {{ states('sensor.ws_rain_rate') }} mm/h
            · Wind gust: {{ states('sensor.ws_wind_gust') }}
            · Condition: {{ states('sensor.ws_current_condition') }}
          style: |
            ha-card { background: rgba(255, 152, 0, 0.15); }

      # --- Weather entity card (built-in) ---
      - type: weather-forecast
        entity: weather.ws
        show_forecast: true
        forecast_type: daily

      # --- Current conditions grid ---
      - type: grid
        columns: 3
        square: false
        cards:
          - type: entity
            entity: sensor.ws_temperature
            name: Temperature
            icon: mdi:thermometer
          - type: entity
            entity: sensor.ws_feels_like
            name: Feels Like
            icon: mdi:thermometer-lines
          - type: entity
            entity: sensor.ws_humidity
            name: Humidity
            icon: mdi:water-percent
          - type: entity
            entity: sensor.ws_dew_point
            name: Dew Point
            icon: mdi:weather-fog
          - type: entity
            entity: sensor.ws_wet_bulb
            name: Wet Bulb
            icon: mdi:thermometer-water
          - type: entity
            entity: sensor.ws_frost_point
            name: Frost Point
            icon: mdi:snowflake-thermometer

      # --- Wind ---
      - type: entities
        title: Wind
        icon: mdi:weather-windy
        entities:
          - entity: sensor.ws_wind_speed
            name: Speed
          - entity: sensor.ws_wind_gust
            name: Gust
          - entity: sensor.ws_wind_direction
            name: Direction
          - entity: sensor.ws_wind_beaufort
            name: Beaufort Scale
          - entity: sensor.ws_wind_quadrant
            name: Quadrant
          - entity: sensor.ws_wind_gust_max_24h
            name: Max Gust (24h)

      # --- Pressure ---
      - type: entities
        title: Pressure
        icon: mdi:gauge
        entities:
          - entity: sensor.ws_station_pressure
            name: Station
          - entity: sensor.ws_sea_level_pressure
            name: Sea Level (MSLP)

      # --- Rain Nowcasting ---
      - type: entities
        title: "Precipitation Now"
        icon: mdi:weather-pouring
        entities:
          - entity: sensor.ws_rain_rate
            name: Rain Rate
          - entity: sensor.ws_rain_last_1h
            name: Last 1 Hour
          - entity: sensor.ws_rain_last_24h
            name: Last 24 Hours
          - entity: sensor.ws_rain_total
            name: Season Total
          - entity: sensor.ws_time_since_rain
            name: Last Rain
          - entity: sensor.ws_rain_probability_combined
            name: Rain Probability

      # --- UV & Solar ---
      - type: entities
        title: UV & Solar
        icon: mdi:weather-sunny-alert
        entities:
          - entity: sensor.ws_uv_index
            name: UV Index
          - entity: sensor.ws_illuminance
            name: Illuminance

      # --- 24h Statistics ---
      - type: grid
        columns: 3
        square: false
        cards:
          - type: entity
            entity: sensor.ws_temperature_high_24h
            name: High (24h)
            icon: mdi:thermometer-high
          - type: entity
            entity: sensor.ws_temperature_low_24h
            name: Low (24h)
            icon: mdi:thermometer-low
          - type: entity
            entity: sensor.ws_wind_gust_max_24h
            name: Max Gust (24h)
            icon: mdi:weather-windy-variant

      # --- Temperature history ---
      - type: history-graph
        title: Temperature (24h)
        hours_to_show: 24
        entities:
          - entity: sensor.ws_temperature
            name: Actual
          - entity: sensor.ws_feels_like
            name: Feels Like
          - entity: sensor.ws_dew_point
            name: Dew Point

      # --- Pressure history ---
      - type: history-graph
        title: Pressure (24h)
        hours_to_show: 24
        entities:
          - entity: sensor.ws_sea_level_pressure
            name: MSLP

      # --- Wind history ---
      - type: history-graph
        title: Wind (24h)
        hours_to_show: 24
        entities:
          - entity: sensor.ws_wind_speed
            name: Speed
          - entity: sensor.ws_wind_gust
            name: Gust

  # =============================================
  # PAGE 2: RADAR & ANALYSIS
  # =============================================
  - title: Radar
    path: radar
    icon: mdi:radar
    cards:
      # --- Precipitation Radar (Windy embed) ---
      # Update lat=XX.XX&lon=XX.XX and detailLat/detailLon to your coordinates.
      - type: iframe
        title: Precipitation Radar
        url: >-
          https://embed.windy.com/embed2.html?lat=37.80&lon=23.90&zoom=8&level=surface&overlay=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&detailLat=37.80&detailLon=23.90&metricWind=km%2Fh&metricTemp=%C2%B0C
        aspect_ratio: 75%

      # --- Wind radar (Windy wind layer) ---
      - type: iframe
        title: Wind Field
        url: >-
          https://embed.windy.com/embed2.html?lat=37.80&lon=23.90&zoom=8&level=surface&overlay=wind&menu=&message=&marker=&calendar=now&pressure=true&type=map&location=coordinates&detail=&detailLat=37.80&detailLon=23.90&metricWind=km%2Fh&metricTemp=%C2%B0C
        aspect_ratio: 75%

      # --- Rain accumulation history ---
      - type: history-graph
        title: Rain Rate & Accumulation (24h)
        hours_to_show: 24
        entities:
          - entity: sensor.ws_rain_rate
            name: Rate (mm/h)
          - entity: sensor.ws_rain_last_1h
            name: Last 1h (mm)

      # --- Wind Rose (requires HACS: lovelace-windrose-card) ---
      # Uncomment after installing from HACS > Frontend.
      #
      # - type: custom:windrose-card
      #   title: Wind Rose (24h)
      #   data_period:
      #     hours_to_show: 24
      #   wind_direction_entity:
      #     entity: sensor.ws_wind_direction
      #   windspeed_entities:
      #     - entity: sensor.ws_wind_speed
      #       name: Avg
      #     - entity: sensor.ws_wind_gust
      #       name: Gust

      # --- Extended Analysis (requires feature toggle) ---
      - type: markdown
        content: >-
          Extended analysis sensors below require **Extended analysis** enabled
          in Configure.

      - type: conditional
        conditions:
          - condition: state
            entity: sensor.ws_zambretti_forecast
            state_not: unavailable
        card:
          type: entities
          title: Zambretti Forecast
          icon: mdi:crystal-ball
          entities:
            - entity: sensor.ws_zambretti_forecast
              name: Forecast
            - entity: sensor.ws_current_condition
              name: Current Condition

      - type: conditional
        conditions:
          - condition: state
            entity: sensor.ws_pressure_trend
            state_not: unavailable
        card:
          type: entities
          title: Display Sensors
          icon: mdi:format-list-text
          entities:
            - entity: sensor.ws_pressure_trend
              name: Pressure Trend
            - entity: sensor.ws_rain_display
              name: Rain Intensity
            - entity: sensor.ws_humidity_level
              name: Humidity Level
            - entity: sensor.ws_uv_level
              name: UV Level
            - entity: sensor.ws_station_health
              name: Station Health

  # =============================================
  # PAGE 3: STATION HEALTH
  # =============================================
  - title: Station
    path: station
    icon: mdi:heart-pulse
    cards:
      - type: entities
        title: Station Health
        icon: mdi:heart-pulse
        entities:
          - entity: binary_sensor.ws_package_ok
            name: Package OK
          - entity: sensor.ws_data_quality_banner
            name: Data Quality
          - entity: sensor.ws_alert_state
            name: Alert State
          - entity: sensor.ws_alert_message
            name: Alert Message

      # --- Battery ---
      - type: conditional
        conditions:
          - condition: state
            entity: sensor.ws_battery
            state_not: unavailable
        card:
          type: entity
          entity: sensor.ws_battery
          name: Station Battery

      # --- Rain history ---
      - type: history-graph
        title: Rain Rate (24h)
        hours_to_show: 24
        entities:
          - entity: sensor.ws_rain_rate
            name: Filtered
          - entity: sensor.ws_rain_rate_raw
            name: Raw

  # =============================================
  # PAGE 4: ACTIVITY SCORES
  # =============================================
  - title: Activities
    path: activities
    icon: mdi:run
    cards:
      - type: markdown
        content: >-
          Activity scores require **Activity scores** enabled in Configure.

      - type: grid
        columns: 2
        square: false
        cards:
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.ws_laundry_drying_score
                state_not: unavailable
            card:
              type: entity
              entity: sensor.ws_laundry_drying_score
              name: Laundry Drying
              icon: mdi:hanger
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.ws_running_score
                state_not: unavailable
            card:
              type: entity
              entity: sensor.ws_running_score
              name: Running
              icon: mdi:run
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.ws_stargazing_quality
                state_not: unavailable
            card:
              type: entity
              entity: sensor.ws_stargazing_quality
              name: Stargazing
              icon: mdi:telescope
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.ws_fire_risk_score
                state_not: unavailable
            card:
              type: entity
              entity: sensor.ws_fire_risk_score
              name: Fire Risk
              icon: mdi:fire
